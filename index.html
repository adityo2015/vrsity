<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAUST Attendance - Academic Detailed Version</title>
    <style>
        :root { --baust-blue: #003366; --bg: #f4f7f6; --danger: #dc3545; --success: #28a745; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 1300px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        header { text-align: center; border-bottom: 3px solid var(--baust-blue); margin-bottom: 20px; padding-bottom: 10px; }
        header h1 { color: var(--baust-blue); margin: 0; }

        .control-panel { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ddd; }
        .form-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-weight: bold; font-size: 11px; color: #555; text-transform: uppercase; }
        input, select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 13px; }
        
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; font-size: 13px; }
        th { background: var(--baust-blue); color: white; }

        .btn { padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-add { background: var(--baust-blue); color: white; align-self: flex-end; }
        .btn-save { background: var(--success); color: white; width: 100%; margin: 10px 0; font-size: 16px; }
        .btn-report { background: #6c757d; color: white; width: 100%; margin-bottom: 10px; }
        
        .active-p { background: var(--success) !important; color: white !important; }
        .active-a { background: var(--danger) !important; color: white !important; }

        /* REPORT VIEW */
        #reportView { display: none; padding: 50px; background: white; border: 2px solid #333; }
        .report-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; font-weight: bold; border: 1px solid #eee; padding: 15px; }
        .sig-box { margin-top: 80px; display: flex; justify-content: space-between; }
        .sig-line { border-top: 1px solid #000; width: 220px; text-align: center; padding-top: 5px; }

        @media print {
            body * { visibility: hidden; }
            #reportView, #reportView * { visibility: visible; }
            #reportView { position: absolute; left: 0; top: 0; width: 100%; display: block !important; }
            .no-print { display: none; }
        }
    </style>
</head>
<body>

<div class="container no-print">
    <header>
        <h1>BAUST ATTENDANCE MANAGER</h1>
        <p>Departmental & Course-wise Academic Portal</p>
    </header>

    <div class="control-panel">
        <div class="form-group"><label>Date</label><input type="date" id="selectedDate"></div>
        <div class="form-group">
            <label>Dept</label>
            <select id="attDept"><option>CSE</option><option>EEE</option><option>ME</option><option>CE</option><option>IPE</option><option>BBA</option></select>
        </div>
        <div class="form-group">
            <label>Level</label>
            <select id="lvl"><option>Level 1</option><option>Level 2</option><option>Level 3</option><option>Level 4</option></select>
        </div>
        <div class="form-group">
            <label>Term</label>
            <select id="trm"><option>Term I</option><option>Term II</option></select>
        </div>
        <div class="form-group"><label>Course Code</label><input type="text" id="cCode" placeholder="CSE-1101"></div>
        <div class="form-group"><label>Course Name</label><input type="text" id="cName" placeholder="Physics"></div>
    </div>

    <div class="control-panel" style="background: #eef2f7;">
        <div style="grid-column: span 2;" class="form-group"><label>Student Name</label><input type="text" id="stuName"></div>
        <div style="grid-column: span 2;" class="form-group"><label>Student ID</label><input type="text" id="stuID"></div>
        <button class="btn btn-add" onclick="addStudent()">+ Register Student</button>
    </div>

    <div style="display: flex; gap: 10px; margin: 15px 0;">
        <button class="btn" style="background:#444; color:white;" onclick="markAll('Present')">Mark All Present</button>
        <button class="btn" style="background:#888; color:white;" onclick="markAll('Absent')">Mark All Absent</button>
    </div>

    <table>
        <thead>
            <tr><th>ID</th><th>Student Name</th><th>Level/Term</th><th>Status</th><th>Cumulative Record</th><th>%</th><th>Action</th></tr>
        </thead>
        <tbody id="attBody"></tbody>
    </table>

    <button class="btn btn-save" onclick="saveAttendance()">SAVE ATTENDANCE FOR THIS SESSION</button>
    <button class="btn btn-report" onclick="generateReport()">GENERATE ACADEMIC REPORT</button>
</div>

<div id="reportView">
    <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px;">
        <h2 style="margin:0">BANGLADESH ARMY UNIVERSITY OF SCIENCE AND TECHNOLOGY</h2>
        <p style="margin:5px">Academic Attendance Summary</p>
    </div>

    <div class="report-grid">
        <div>
            Course Name: <span id="repCName"></span><br>
            Course Code: <span id="repCCode"></span><br>
            Department: <span id="repDept"></span>
        </div>
        <div style="text-align: right;">
            Level/Term: <span id="repLT"></span><br>
            Date: <span id="repDate"></span><br>
            Report Type: Official
        </div>
    </div>

    <table style="width:100%">
        <thead>
            <tr>
                <th>ID</th>
                <th style="text-align:left">Name</th>
                <th>Total Classes</th>
                <th>Days Present</th>
                <th>Percentage</th>
                <th>Remark</th>
            </tr>
        </thead>
        <tbody id="repBody"></tbody>
    </table>

    <div class="sig-box">
        <div class="sig-line">Course Instructor</div>
        <div class="sig-line">Head of the Department</div>
    </div>

    <div class="no-print" style="margin-top: 50px; text-align: center;">
        <button class="btn" style="background:#003366; color:#fff; width:200px" onclick="window.print()">PRINT REPORT</button>
        <button class="btn" style="background:#666; color:#fff; width:200px" onclick="document.getElementById('reportView').style.display='none'">BACK TO DASHBOARD</button>
    </div>
</div>

<script>
    let students = JSON.parse(localStorage.getItem('baust_att_v6')) || [];
    document.getElementById('selectedDate').valueAsDate = new Date();

    window.onload = renderTable;

    function addStudent() {
        const name = document.getElementById('stuName').value;
        const id = document.getElementById('stuID').value;
        const dept = document.getElementById('attDept').value;
        const lvl = document.getElementById('lvl').value;
        const trm = document.getElementById('trm').value;
        
        if(!name || !id) return alert("Enter Student Info");
        
        students.push({ id, name, dept, lvl, trm, pCount: 0, tDays: 0, status: 'Absent' });
        saveData();
        renderTable();
        document.getElementById('stuName').value = "";
        document.getElementById('stuID').value = "";
    }

    function markAll(status) {
        students.forEach(s => s.status = status);
        renderTable();
    }

    function setStatus(i, status) {
        students[i].status = status;
        renderTable();
    }

    function saveAttendance() {
        const cCode = document.getElementById('cCode').value;
        if(!cCode) return alert("Please enter a Course Code!");
        
        students.forEach(s => {
            s.tDays++;
            if(s.status === 'Present') s.pCount++;
        });
        saveData();
        renderTable();
        alert("Attendance recorded for " + cCode);
    }

    function saveData() { localStorage.setItem('baust_att_v6', JSON.stringify(students)); }

    function renderTable() {
        const body = document.getElementById('attBody');
        body.innerHTML = "";
        students.forEach((s, i) => {
            const perc = s.tDays === 0 ? 0 : ((s.pCount / s.tDays) * 100).toFixed(1);
            body.innerHTML += `
                <tr>
                    <td><strong>${s.id}</strong></td><td>${s.name}</td><td>${s.lvl} ${s.trm}</td>
                    <td>
                        <button class="btn ${s.status==='Present'?'active-p':''}" style="border:1px solid green" onclick="setStatus(${i},'Present')">P</button>
                        <button class="btn ${s.status==='Absent'?'active-a':''}" style="border:1px solid red" onclick="setStatus(${i},'Absent')">A</button>
                    </td>
                    <td>${s.pCount} / ${s.tDays}</td>
                    <td style="color:${perc < 75 ? 'red' : 'green'}">${perc}%</td>
                    <td><button style="border:none; background:none; cursor:pointer;" onclick="if(confirm('Delete?')){students.splice(${i},1);saveData();renderTable();}">ðŸ—‘</button></td>
                </tr>`;
        });
    }

    function generateReport() {
        const dept = document.getElementById('attDept').value;
        const cCode = document.getElementById('cCode').value;
        const cName = document.getElementById('cName').value;
        const lvl = document.getElementById('lvl').value;
        const trm = document.getElementById('trm').value;
        const date = document.getElementById('selectedDate').value;

        if(!cCode) return alert("Enter Course Code for report!");

        document.getElementById('repDept').innerText = dept;
        document.getElementById('repCCode').innerText = cCode;
        document.getElementById('repCName').innerText = cName || "N/A";
        document.getElementById('repLT').innerText = lvl + " " + trm;
        document.getElementById('repDate').innerText = date;
        
        const repBody = document.getElementById('repBody');
        repBody.innerHTML = "";
        
        const filtered = students.filter(s => s.dept === dept);
        filtered.forEach(s => {
            const perc = s.tDays === 0 ? 0 : ((s.pCount / s.tDays) * 100).toFixed(1);
            repBody.innerHTML += `
                <tr>
                    <td>${s.id}</td><td style="text-align:left">${s.name}</td>
                    <td>${s.tDays}</td><td>${s.pCount}</td>
                    <td>${perc}%</td><td>${perc < 75 ? 'IRREGULAR' : 'REGULAR'}</td>
                </tr>`;
        });
        document.getElementById('reportView').style.display = 'block';
    }
</script>
</body>
</html>